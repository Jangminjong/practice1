<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="GoodsDAO">
 	<resultMap type="goodsVO" id="goodsResult">
 		<result property="goods_code" column="goods_code"/>
 		<result property="goods_name" column="goods_name"/>
 		<result property="goods_price" column="goods_price"/>
 		<result property="seller_code" column="seller_code"/>
 		<result property="goods_category" column="goods_category"/>
 		<result property="goods_photo" column="goods_photo" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="goods_stock" column="goods_stock"/>
 		<result property="goods_volume" column="goods_volume"/>
 		<result property="goods_income" column="goods_income"/>
 		<result property="goods_grade" column="goods_grade"/>
 		<result property="goods_info" column="goods_info"/>
 		<result property="goods_select" column="goods_select"/>
 		<result property="goods_view" column="goods_view"/>
 		<result property="goods_op1_code" column="goods_op1_code"/>
 		<result property="goods_op2_code" column="goods_op2_code"/>
 		<result property="goods_op3_code" column="goods_op3_code"/>
 		<result property="goods_seq" column="goods_seq"/>
 		<result property="goods_apply_date" column="goods_apply_date"/>
 		<result property="goods_status" column="goods_status"/>
 		<result property="goods_delivery_fee" column="goods_delivery_fee"/>
 		<collection property="userSellerVO" resultMap="userSellerResult" />
 		<collection property="goodsOption1VO" resultMap="goodsOption1Result" />
 		<collection property="goodsOption2VO" resultMap="goodsOption2Result" />
 		<collection property="goodsOption3VO" resultMap="goodsOption3Result" />
 	</resultMap>
 	
 	<resultMap type="UserSellerVO" id="userSellerResult">
 		<result property="seller_code" column="seller_code"/>
 		<result property="store_name" column="store_name"/>
 		<result property="seller_profile" column="seller_profile"/>
 		<result property="seller_profile_img" column="seller_profile_img" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 	</resultMap>
 	
 	<resultMap type="goodsReviewVO" id="goodsReviewResult">
 		<result property="goods_review_seq" column="goods_review_seq"/>
 		<result property="goods_review_id" column="goods_review_id"/>
 		<result property="goods_review_code" column="goods_review_code"/>
 		<result property="goods_review_date" column="goods_review_date"/>
 		<result property="goods_review_point" column="goods_review_point"/>
 		<result property="goods_review_image" column="goods_review_image" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="goods_review_option1" column="goods_review_option1"/>
 		<result property="goods_review_option2" column="goods_review_option2"/>
 		<result property="goods_review_option3" column="goods_review_option3"/>
 		<result property="goods_review_context" column="goods_review_context"/>
 		<result property="goods_photo" column="goods_photo" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/> 
 	</resultMap>
 	
 	<resultMap type="goodsOption1VO" id="goodsOption1Result">
 		<result property="goods_op1_code" column="goods_op1_code"/>
 		<result property="goods_code" column="goods_code"/>
 		<result property="goods_op1_name" column="goods_op1_name"/>
 		<result property="goods_op1_value" column="goods_op1_value" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="goods_op1_price" column="goods_op1_price" typeHandler="org.apache.ibatis.type.ArrayTypeHandler" javaType="Integer[]"/>
 	</resultMap>
 	
 	<resultMap type="goodsOption2VO" id="goodsOption2Result">
 		<result property="goods_op2_code" column="goods_op2_code"/>
 		<result property="goods_code" column="goods_code"/>
 		<result property="goods_op2_name" column="goods_op2_name"/>
 		<result property="goods_op2_value" column="goods_op2_value" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="goods_op2_price" column="goods_op2_price" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 	</resultMap>
 	
 	<resultMap type="goodsOption3VO" id="goodsOption3Result">
 		<result property="goods_op3_code" column="goods_op3_code"/>
 		<result property="goods_code" column="goods_code"/>
 		<result property="goods_op3_name" column="goods_op3_name"/>
 		<result property="goods_op3_value" column="goods_op3_value" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="goods_op3_price" column="goods_op3_price" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 	</resultMap>
 	
 	<resultMap type="goodsOptionListVO" id="goodsOptinoListResult">
 		<collection property="goodsOption1VO" resultMap="goodsOption1Result" />
 		<collection property="goodsOption2VO" resultMap="goodsOption2Result" />
 		<collection property="goodsOption3VO" resultMap="goodsOption3Result" />
 	</resultMap>
 	

 	<select id="getGoodsList" resultMap="goodsResult" parameterType="goodsVO">
	SELECT * FROM (SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (SELECT goods.*, goods_review.goods_review_context
	FROM goods AS goods LEFT OUTER JOIN goods_review AS goods_review ON goods.goods_code = goods_review.goods_review_code where goods_category=#{goods_category} ORDER BY goods_volume DESC)A)AS foo WHERE rownum BETWEEN 1 AND 10
 	</select>
 	
 	<!-- 작가가 등록한 상품리스트 가져오기 -->
 	<select id="getSellerGoodsList" resultMap="goodsResult" parameterType="goodsVO">
	SELECT * FROM (SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (select * from goods where seller_code=#{countNotice})A)AS foo WHERE rownum BETWEEN #{start} AND #{end}
 	</select>
 	
 	<!-- 작품 상세보기 -->
 	<select id="getGoodsContent" resultMap="goodsResult">
 		select
 			g.goods_name, g.goods_price, g.goods_select, g.goods_stock, g.goods_op1_code, g.goods_op2_code, g.goods_op3_code, g.goods_photo, g.goods_info, g.goods_delivery_fee
 			, s.user_id, s.store_name, s.seller_name, s.seller_profile, s.seller_profile_img
 		from goods as g
 		join seller as s on s.seller_code = g.seller_code
 		where g.goods_code=#{goods_code}
 	</select>
 	
 	<!-- 상품에 대한 리뷰 리스트 -->
 	<select id="getGoodsReviewList" resultMap="goodsReviewResult">
 		select * from goods_review where goods_review_code = #{goods_review_code}
 	</select>
 	
 	<!-- 상품 옵션리스트 가져오기 -->
 	<select id="getGoodsOptionList" resultMap="goodsResult">
	select
		*
		from goods as g
		join goods_option1 as go1 on go1.goods_op1_code = g.goods_op1_code
		left join goods_option2 as go2 on go2.goods_op2_code = g.goods_op2_code
		left join goods_option3 as go3 on go3.goods_op3_code = g.goods_op3_code
	where g.goods_code=#{good_code}
 	</select>

 	<select id="goodsCount" resultType="_int" parameterType="string">
		SELECT COUNT(*) FROM goods WHERE goods_category=#{goods_category}
 	</select>
 	<select id="getGoodsListWithCategory" resultMap="goodsResult">
		SELECT * FROM (
			SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (
			SELECT goods.*, seller.store_name, goods_review.goods_review_context FROM goods 
			LEFT OUTER JOIN seller ON goods.seller_code = seller.seller_code 
			LEFT OUTER JOIN goods_review ON goods.goods_code = goods_review.goods_review_code 
			WHERE goods_category=#{searchCondition})A)AS foo 
			WHERE rownum BETWEEN #{start} AND #{end}
 	</select>
 	<select id="getGoodsListSortVolume" resultMap="goodsResult">
		SELECT * FROM (
			SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (
			SELECT goods.*, seller.store_name, goods_review.goods_review_context FROM goods 
			LEFT OUTER JOIN seller ON goods.seller_code = seller.seller_code 
			LEFT OUTER JOIN goods_review ON goods.goods_code = goods_review.goods_review_code 
			WHERE goods_category=#{searchCondition} ORDER BY goods_volume DESC )A)AS foo 
			WHERE rownum BETWEEN #{start} AND #{end}
 	</select>
 	<select id="getGoodsListSortRowPrice" resultMap="goodsResult" parameterType="com.idwith.mpweb.common.PagingVO">
		SELECT * FROM (
			SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (
			SELECT goods.*, seller.store_name, goods_review.goods_review_context FROM goods 
			LEFT OUTER JOIN seller ON goods.seller_code = seller.seller_code 
			LEFT OUTER JOIN goods_review ON goods.goods_code = goods_review.goods_review_code 
			WHERE goods_category=#{searchCondition} ORDER BY goods_price ASC )A)AS foo 
			WHERE rownum BETWEEN #{start} AND #{end}
 	</select>
 	<select id="getGoodsListSortHighPrice" resultMap="goodsResult">
		SELECT * FROM (
			SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (
			SELECT goods.*, seller.store_name, goods_review.goods_review_context FROM goods 
			LEFT OUTER JOIN seller ON goods.seller_code = seller.seller_code 
			LEFT OUTER JOIN goods_review ON goods.goods_code = goods_review.goods_review_code 
			WHERE goods_category=#{searchCondition} ORDER BY goods_price DESC )A)AS foo 
			WHERE rownum BETWEEN #{start} AND #{end}
 	</select>
 	<select id="getGoodsListWithPrice" resultMap="goodsResult">
		SELECT * FROM (
			SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (
			SELECT goods.*, seller.store_name, goods_review.goods_review_context FROM goods 
			LEFT OUTER JOIN seller ON goods.seller_code = seller.seller_code 
			LEFT OUTER JOIN goods_review ON goods.goods_code = goods_review.goods_review_code 
			WHERE goods_category=#{searchCondition} AND goods_price BETWEEN #{min} AND #{max})A)AS foo 
			WHERE rownum BETWEEN #{start} AND #{end}
 	</select>
 	<!-- 인기페이지에서 사용 -->
 	<select id="getGoodsListForPopular" resultMap="goodsResult" parameterType="goodsVO">
	SELECT * FROM (SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (SELECT goods.*, goods_review.goods_review_context
	FROM goods AS goods LEFT OUTER JOIN goods_review AS goods_review ON goods.goods_code = goods_review.goods_review_code where goods_category=#{goods_category} ORDER BY goods_volume DESC)A)AS foo WHERE rownum BETWEEN 1 AND 10
 	</select>
 	

</mapper>