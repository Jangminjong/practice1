<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="ChoiceDAO">
 	<resultMap type="choiceVO" id="choiceResult">
 		<result property="choice_seq" column="choice_seq"/>
 		<result property="choice_id" column="choice_id"/>
 		<result property="choiced_code" column="choiced_code"/>
 		<result property="choice_date" column="choice_date"/>
 		<result property="choice_true" column="choice_true"/>
 	</resultMap>
 	
 	<resultMap type="followVO" id="followResult">
 		<result property="follow_seq" column="follow_seq"/>
 		<result property="follow_id" column="follow_id"/>
 		<result property="followed_id" column="followed_id"/>
 		<result property="follow_date" column="follow_date"/>
 		
 		<result property="seller_code" column="seller_code"/>
 		<result property="seller_name" column="seller_name"/>
 		<result property="seller_sellno" column="seller_sellno"/>
 		<result property="seller_indate" column="seller_indate"/>
 		<result property="seller_sellno_img" column="seller_sellno_img" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="user_id" column="user_id"/>
 		<result property="seller_profile" column="seller_profile"/>
 		<result property="seller_profile_img" column="seller_profile_img" typeHandler="org.apache.ibatis.type.ArrayTypeHandler"/>
 		<result property="seller_done" column="seller_done"/>
 		<result property="seller_goods_yn" column="seller_goods_yn"/>
 		<result property="seller_class_yn" column="seller_class_yn"/>
 		<result property="seller_status" column="seller_status"/>
 		<result property="store_name" column="store_name"/>
 	</resultMap>
 	
 		
 	
 	<!-- 상품 좋아요 추가 -->
 	<insert id="addChoice" parameterType="choiceVO">
 		INSERT INTO choice (choice_id, choiced_code, choice_date, choice_true)
 		VALUES(#{choice_id}, #{choiced_code}, now(), true)
 	</insert>
 	<!-- 찜 목록 조회 -->
 	<select id="setChoice" resultType="choiceVO">
 		SELECT * FROM choice WHERE choice_id=#{choice_id} AND choice_true=true
 	</select>
 	<!-- 기존 찜 기록이 있는지 확인 -->
 	<select id="selectChoice" resultType="_int" parameterType="choiceVO">
 		SELECT count(*) FROM choice WHERE choiced_code=#{choiced_code} AND choice_id = #{choice_id}
 	</select>
 	<!-- 찜 취소 -->
 	<update id="cancelChoice" parameterType="choiceVO">
 		UPDATE choice
 		SET choice_true=false WHERE choiced_code=#{choiced_code} AND choice_id = #{choice_id}
 	</update>
 	<update id="updateChoice" parameterType="choiceVO">
 		UPDATE choice
 		SET choice_true=true WHERE choiced_code=#{choiced_code} AND choice_id = #{choice_id}
 	</update>
 	
 	<!-- 팔로우 -->
 	<!-- 팔로우 추가 -->
 	<insert id="addFollow" parameterType="followVO">
 		INSERT INTO follow (follow_id, followed_id, follow_date)
 		VALUES(#{follow_id}, #{followed_id}, now())
 	</insert>
 	<!-- 팔로우 목록 조회 -->
 	<select id="setFollow" resultType="followVO">
 		SELECT * FROM follow WHERE follow_id=#{follow_id}
 	</select>
 	<!-- 기존 팔로우 기록이 있는지 확인 -->
 	<select id="selectFollow" resultType="_int" parameterType="choiceVO">
 		SELECT count(*) FROM follow WHERE followed_id=#{followed_id} AND follow_id = #{follow_id}
 	</select>
 	<!-- 팔로우 취소 -->
 	<delete id="deleteFollow" parameterType="followVO">
 		DELETE FROM follow WHERE followed_id=#{followed_id} AND follow_id=#{follow_id}
 	</delete>
 	
 	<select id="getFollowSellerList" parameterType="string" resultMap="followResult">
 		SELECT * FROM (
			SELECT follow.*, seller.* FROM follow 
			LEFT OUTER JOIN seller ON follow.followed_id = seller.seller_code 
				WHERE follow.follow_id=#{email})as foo
 	</select>
</mapper>