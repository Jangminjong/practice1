<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="WriterClassOpenDAO">
 	<resultMap type="writerClassOpen" id="writerClassOpenResult">
 		<result property="classOpenSeq" column="class_open_seq"/>
 		<result property="classOpenSeller" column="class_open_seller"/>
 		<result property="className" column="class_name"/>
 		<result property="classOpenName" column="class_open_name"/>
 		<result property="classOpenClassCode" column="class_open_class_code"/>
 		<result property="classOpenCategory" column="class_open_category"/>
 		<result property="classOpenPrice" column="class_open_price"/>
 		<result property="classOpenPostAddress" column="class_open_post_address"/>
 		<result property="classOpenAddress" column="class_open_address"/>
 		<result property="classOpenDetailAddress" column="class_open_detail_address"/>
 		<result property="classOpenReference" column="class_open_reference"/>
 		<result property="classOpenDate" column="class_open_date"/>
 		<result property="classOpenTime" column="class_open_time"/>
 		<result property="classCloseTime" column="class_close_time"/>
 		<result property="classOpenPhoto" column="class_open_photo" typeHandler="org.apache.ibatis.type.ArrayTypeHandler" />
 		<result property="classOpenDifficult" column="class_open_difficult"/>
 		<result property="classOpenInfo" column="class_open_info"/>
 		<result property="classOpenPhone" column="class_open_phone"/>
 		<result property="classOpenMaxPerson" column="class_Open_Max_person"/>
 		<collection property="writerClassCategoryVO" resultMap="category"></collection>
 	</resultMap>
 	<resultMap type="writerClassCategory" id="category">
 		<result property="classCategoryCode" column="class_category_code"/>
 		<result property="classCategoryName" column="class_category_name"/>
 	</resultMap>
 	<!-- 클래스오픈 등록 전 시간 확인 -->
	<select id="timeCheck" parameterType="writerClassOpen" resultMap="writerClassOpenResult">
	 	<![CDATA[	
	 		SELECT class_open_name, class_open_time, class_close_time from class_open
	 		where (class_open_date = #{classOpenDate} and class_open_name = #{classOpenName})  and
		 		  ( (class_open_time > #{classOpenTime} and #{classCloseTime} between class_open_time and class_close_time) or
		 		    ((#{classOpenTime} between class_open_time and class_close_time) and (#{classCloseTime} between class_open_time and class_close_time)) or
		 		    ((#{classOpenTime} between class_open_time and class_close_time) and (#{classCloseTime} > class_close_time) ) or
		 		    ((#{classOpenTime} < class_open_time and #{classCloseTime} > class_close_time)) )
 		]]>
 	</select>	
	
 	<!-- 클래스오픈 테이블에 등록  -->
	<insert id="insertClassOpen" parameterType="writerClassOpen">
	INSERT INTO class_Open (
 								 class_open_name,
 								 class_open_seller,
 								 class_open_class_code,
 								 class_open_category,
 								 class_open_price,
 								 class_open_post_address,
 								 class_open_address,
 								 class_open_detail_address,
 								 class_open_reference,
 								 class_open_date,
 								 class_open_time,
 								 class_close_time,
 								 class_open_photo,
 								 class_open_difficult,
 								 class_open_info,
 								 class_open_phone,
 								 class_open_max_person
 								 )
 								
 							VALUES(#{classOpenName},
				 			   #{classOpenSeller},
				 			   #{classOpenClassCode},
				 			   #{classOpenCategory},
				 			   #{classOpenPrice},
				 			   #{classOpenPostAddress},
				 			   #{classOpenAddress},
				 			   #{classOpenDetailAddress},
				 			   #{classOpenReference},
				 			   #{classOpenDate},
				 			   #{classOpenTime},
				 			   #{classCloseTime},
				 			   #{classOpenPhoto, typeHandler=org.apache.ibatis.type.ArrayTypeHandler},
				 			   #{classOpenDifficult},
				 			   #{classOpenInfo},
				 			   #{classOpenPhone},
				 			   #{classOpenMaxPerson})
	</insert>
	<!-- 클래스 오픈 등록에 className 추가 등록 -->
	<insert id="insertClassName" parameterType="writerClassOpen">
		INSERT INTO class_open(class_name) select class_name from class_reg where class_code = #{classOpenClassCode}
	</insert>
	
	<!-- 클래스오픈 리스트 개수 조회 -->
 	<select id="classOpenCount" resultType="_int">
 		select count(*) from class_open where class_open_seller=#{classOpenSeller}
 	</select>
 	
 	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="classOpenList" parameterType="writerClassOpen" resultMap="writerClassOpenResult">
>>>>>>> class-open
	SELECT * FROM (SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (SELECT *
	FROM class_open WHERE class_open_seller=#{countNotice} ORDER BY class_open_seq DESC)A)AS foo WHERE rownum BETWEEN #{start} AND #{end}
	</select>
	
	<!-- 클래스오픈 상세 확인 -->
	<select id="classOpen" resultMap="writerClassOpenResult">
	select  clop.class_open_seq,
			clop.class_name,
			clop.class_open_name,
			clop.class_open_seller,
			clop.class_open_class_code,
			clop.class_open_category,
			clop.class_open_price,
			clop.class_open_post_address,
			clop.class_open_address,
			clop.class_open_detail_address,
			clop.class_open_reference,
			clop.class_open_date,
			clop.class_open_time,
			clop.class_close_time,
			clop.class_open_photo,
			clop.class_open_difficult,
			clop.class_open_info,
			clop.class_open_phone,
			clop.class_open_max_person,
			clcg.class_category_code,
			clcg.class_category_name
	from class_open as clop join class_category as clcg on clcg.class_category_code = clop.class_open_category
	where class_open_seq = #{classOpenSeq}
	</select>
	
	<!--  클래스오픈 수정 -->
	<update id="classOpenUpdate" parameterType="writerClassOpen">
		UPDATE class_open SET class_open_price = #{classOpenPrice},
						 class_open_name = #{classOpenName},
						 class_open_post_address = #{classOpenPostAddress},
						 class_open_address = #{classOpenAddress},
						 class_open_detail_address = #{classOpenDetailAddress},
						 class_open_reference = #{classOpenReference},
						 class_open_info = #{classOpenInfo},
						 class_open_difficult = #{classOpenDifficult},
						 class_open_phone = #{classOpenPhone},
						 class_open_date = #{classOpenDate},
						 class_open_time = #{classOpenTime},
						 class_close_time = #{classCloseTime},
						 class_open_max_person = #{classOpenMaxPerson},
						 class_open_photo = #{classOpenPhoto, typeHandler=org.apache.ibatis.type.ArrayTypeHandler}
					  WHERE class_open_seq = ${classOpenSeq}
	</update>
	<!-- 클래스오픈 삭제 -->
	<delete id="classOpenDelete" parameterType="writerClassOpen">
		DELETE FROM class_open where class_open_seq = #{classOpenSeq}
	</delete>
</mapper>