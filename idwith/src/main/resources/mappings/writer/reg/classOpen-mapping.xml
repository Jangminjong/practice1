<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="WriterClassOpenDAO">
 	<resultMap type="writerClassOpen" id="writerClassOpenResult">
 		<result property="classOpenSeq" column="class_open_seq"/>
 		<result property="classOpenName" column="class_open_name"/>
 		<result property="classOpenClassCode" column="class_open_class_code"/>
 		<result property="classOpenCategory" column="class_open_category"/>
 		<result property="classOpenPrice" column="class_open_price"/>
 		<result property="classOpenPostAddress" column="class_open_post_address"/>
 		<result property="classOpenAddress" column="class_open_address"/>
 		<result property="classOpenDetailAddress" column="class_open_detail_address"/>
 		<result property="classOpenReference" column="class_open_reference"/>
 		<result property="classOpenDate" column="class_open_date"/>
 		<result property="classOpenTime" column="class_open_time"/>
 		<result property="classCloseTime" column="class_close_time"/>
 		<result property="classOpenPhoto" column="class_open_photo" typeHandler="org.apache.ibatis.type.ArrayTypeHandler" />
 		<result property="classOpenDifficult" column="class_open_difficult"/>
 		<result property="classOpenInfo" column="class_open_info"/>
 		<result property="classOpenPhone" column="class_open_phone"/>
 		<result property="classOpenMaxPerson" column="class_Open_Max_person"/>
 	</resultMap>
 	<!-- 클래스오픈 등록 전 시간 확인 -->
 <!-- 	<select id="timeCheck" parameterType="writerClassOpen" resultMap="writerClassOpenResult">
 		SELECT count(class_open_time) from class_open where class_open_date = #{classOpenDate} and ( class_open_time < #{class_close_time} or class_close_time 
 	</select>	 -->
	
 	<!-- 클래스오픈 테이블에 등록  -->
 	<insert id="insertClassReg" parameterType="writerClassReg">
 		INSERT INTO class_reg (
 								 class_seller,
 								 class_category,
 								 class_code,
 								 class_post_address,
 								 class_address,
 								 class_detail_address,
 								 class_reference,
 								 class_info,
 								 class_phone,
 								 class_photo,
 								 class_status
 								 )
 		VALUES(#{classSeller},
 			   #{classCategory},
 			   #{classCode},
 			   #{classPostAddress},
 			   #{classAddress},
 			   #{classDetailAddress},
 			   #{classReference},
 			   #{classInfo},
 			   #{classPhone},
 			   #{classPhoto, typeHandler=org.apache.ibatis.type.ArrayTypeHandler},
 			   0
 			   )
 	</insert>

 	<!-- 클래스오픈 리스트 개수 조회 -->
 	<select id="classRegCount" resultType="_int">
 		select count(*) from class_reg where class_seller=#{classSeller}
 	</select>
 	
 	<!-- 페이징 처리 후 게시글 조회 -->
	<select id="classRegList" parameterType="writerClassReg" resultMap="writerClassRegResult">
	SELECT * FROM (SELECT ROW_NUMBER() OVER() as rownum, A.* FROM (SELECT *
	FROM class_reg WHERE class_seller=#{countNotice} and class_status!=3 ORDER BY class_reg_seq DESC)A)AS foo WHERE rownum BETWEEN #{start} AND #{end}
	</select>
	
	<!-- 클래스오픈 상세 -->
	<select id="classReg" resultMap="writerClassRegResult">
	select  class_reg_seq,
			class_seller,
			class_category,
			class_code,
			class_post_address,
			class_address,
			class_detail_address,
			class_reference,
			class_info,
			class_phone,
			class_photo,
			class_status
	from class_reg 
	where class_reg_seq = #{classRegSeq}
	</select>
	
	<!-- 클래스오픈 수정 -->
	<update id="classRegUpdate" parameterType="writerClassReg">
	UPDATE class_reg SET class_category = #{classCategory},
						 class_post_address = #{classPostAddress},
						 class_address = #{classAddress},
						 class_detail_address = #{classDetailAddress},
						 class_reference = #{classReference},
						 class_info = #{classInfo},
						 class_phone = #{classPhone},
						 class_photo = #{classPhoto, typeHandler=org.apache.ibatis.type.ArrayTypeHandler} WHERE class_reg_seq = ${classRegSeq} 
	</update>
	<!-- 클래스오픈 삭제 -->
	<update id="classRegDelete" parameterType="writerClassReg">
	UPDATE class_reg SET class_status=3 WHERE class_reg_seq = ${classRegSeq}
	</update>
</mapper>